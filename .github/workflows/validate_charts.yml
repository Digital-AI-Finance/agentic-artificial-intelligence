name: Validate Charts

on:
  push:
    paths:
      - 'L*/*/*.py'
      - 'tests/test_charts.py'
  pull_request:
    paths:
      - 'L*/*/*.py'
      - 'tests/test_charts.py'
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          pip install matplotlib numpy seaborn plotly networkx pytest pytest-timeout

      - name: Run chart tests with pytest
        run: |
          pytest tests/test_charts.py -v --timeout=120 --tb=short

      - name: Verify all 48 PDFs exist
        run: |
          # Count PDFs in chart folders (named after folder content, not chart.pdf)
          count=$(find L*/*/ -maxdepth 1 -name "*.pdf" -type f 2>/dev/null | wc -l)
          echo "Found $count chart PDFs"
          if [ "$count" -lt 48 ]; then
            echo "ERROR: Expected 48+ PDFs, found $count"
            exit 1
          fi
          echo "All chart PDFs verified"
